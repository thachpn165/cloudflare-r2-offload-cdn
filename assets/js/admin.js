(function(e){const c={init(){this.cacheElements(),this.bindEvents(),e(".cloudflare-r2-offload-cdn-form-actions").hide(),this.progressInterval=null,this.activityLogInterval=null,this.bulkStartTime=null,this.bulkStats={completed:0,failed:0,total:0},this.isProcessing=!1,this.currentAction="offload"},cacheElements(){this.$tabs=e(".cloudflare-r2-offload-cdn-tabs li"),this.$tabContents=e(".cloudflare-r2-offload-cdn-tab-content"),this.$form=e("#cloudflare-r2-offload-cdn-settings-form"),this.$saveBtn=e(".cloudflare-r2-offload-cdn-save-btn"),this.$toast=e("#cloudflare-r2-offload-cdn-toast")},bindEvents(){this.$tabs.on("click",this.handleTabClick.bind(this)),this.$form.on("submit",this.handleFormSubmit.bind(this)),e(document).on("click",".cloudflare-r2-offload-cdn-accordion-header",this.handleAccordionClick),e("#test-r2-connection").on("click",this.handleTestR2Connection.bind(this)),e("#cfr2-bulk-offload-all").on("click",this.handleBulkOffload.bind(this)),e("#cfr2-bulk-restore-all").on("click",this.handleBulkRestore.bind(this)),e("#cfr2-bulk-delete-local").on("click",this.handleBulkDeleteLocal.bind(this)),e("#cfr2-cancel-bulk").on("click",this.handleCancelBulk.bind(this)),e("#cdn_enabled").on("change",this.handleCDNToggle.bind(this)),e("#smart_sizes").on("change",this.handleSmartSizesToggle.bind(this)),e("#quality").on("input",this.handleQualityChange.bind(this)),e("#deploy-worker").on("click",this.handleDeployWorker.bind(this)),e("#remove-worker").on("click",this.handleRemoveWorker.bind(this)),e("#cfr2-retry-all-failed").on("click",this.handleRetryFailed.bind(this)),e("#cfr2-retry-all").on("click",this.handleRetryFailed.bind(this)),e("#cfr2-clear-log").on("click",this.handleClearLog.bind(this)),e(document).on("click",".cfr2-retry-single",this.handleRetrySingle.bind(this)),e("#goto-bulk-actions").on("click",this.handleGotoBulkActions.bind(this)),e(document).on("click",".cfr2-offload-btn",this.handleAttachmentOffload.bind(this)),e("#validate-cdn-dns").on("click",this.handleValidateCdnDns.bind(this)),e(document).on("click",".cfr2-enable-proxy-btn",this.handleEnableDnsProxy.bind(this)),e("#cfr2-pending-stat").on("click",this.handleShowPending.bind(this)),e("#cfr2-close-pending").on("click",this.handleClosePending.bind(this)),e("#cfr2-clear-pending").on("click",this.handleClearPending.bind(this)),e(document).on("click",".cfr2-cancel-pending-item",this.handleCancelPendingItem.bind(this))},handleTabClick(a){const t=e(a.currentTarget),s=t.data("tab");this.$tabs.removeClass("active"),t.addClass("active"),this.$tabContents.removeClass("active"),e("#tab-"+s).addClass("active"),e(".cloudflare-r2-offload-cdn-form-actions").toggle(s!=="dashboard"&&s!=="bulk-actions"),s==="bulk-actions"&&(this.loadActivityLog(),this.refreshButtonCounts(),this.checkBulkProgress())},handleAccordionClick(a){const t=e(a.currentTarget),s=t.next(".cloudflare-r2-offload-cdn-accordion-content");t.toggleClass("active"),s.toggleClass("active")},handleFormSubmit(a){if(a.preventDefault(),this.$saveBtn.hasClass("is-loading"))return;this.setLoading(!0);const t=this.$form.serialize();e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:t+"&action=cloudflare_r2_offload_cdn_save_settings",success:this.handleSaveSuccess.bind(this),error:this.handleSaveError.bind(this),complete:()=>this.setLoading(!1)})},handleSaveSuccess(a){a.success?this.showToast(a.data.message,"success"):this.showToast(a.data.message||myPluginAdmin.strings.error,"error")},handleSaveError(){this.showToast(myPluginAdmin.strings.error,"error")},setLoading(a){this.$saveBtn.toggleClass("is-loading",a)},showToast(a,t="success"){const s=t==="success"?"yes-alt":"warning",l=e("<div>",{class:`cloudflare-r2-offload-cdn-toast-item ${t}`}).append(e("<span>",{class:`dashicons dashicons-${s}`}),e("<span>").text(a));this.$toast.append(l),setTimeout(()=>{l.addClass("fade-out"),setTimeout(()=>l.remove(),300)},3e3)},handleTestR2Connection(a){a.preventDefault();const t=e(a.currentTarget),s=e("#r2-connection-result");t.hasClass("is-loading")||(t.addClass("is-loading").prop("disabled",!0),s.html('<span class="spinner is-active" style="float:none;margin:0 5px;"></span>'),e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cloudflare_r2_offload_cdn_test_r2",cloudflare_r2_offload_cdn_nonce:e("#cloudflare_r2_offload_cdn_nonce").val(),r2_account_id:e("#r2_account_id").val(),r2_access_key_id:e("#r2_access_key_id").val(),r2_secret_access_key:e("#r2_secret_access_key").val(),r2_bucket:e("#r2_bucket").val()},success:l=>{l.success?(s.html('<span style="color: #46b450;">✓ '+l.data.message+"</span>"),this.showToast(l.data.message,"success")):(s.html('<span style="color: #dc3232;">✗ '+l.data.message+"</span>"),this.showToast(l.data.message,"error"))},error:()=>{s.html('<span style="color: #dc3232;">✗ Connection failed</span>'),this.showToast("Connection test failed","error")},complete:()=>{t.removeClass("is-loading").prop("disabled",!1)}}))},handleBulkOffload(a){if(a.preventDefault(),!confirm("Queue all media files for offload to R2?"))return;const t=e(a.currentTarget);t.prop("disabled",!0).text("Queuing..."),e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_bulk_offload_all",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:s=>{s.success?(this.terminalLog("info",`Queued ${s.data.total} files for offload.`),this.bulkStats={completed:0,failed:0,total:s.data.total},this.startBulkProcessing()):(this.terminalLog("error",s.data.message),this.showToast(s.data.message,"error"),t.prop("disabled",!1).text("Offload All Media"))},error:()=>{this.terminalLog("error","Failed to queue files."),this.showToast("Failed to start bulk offload","error"),t.prop("disabled",!1).text("Offload All Media")}})},handleBulkRestore(a){if(a.preventDefault(),!confirm("Restore all media files from R2 to local?"))return;const t=e(a.currentTarget);t.prop("disabled",!0).text("Queuing..."),e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_bulk_restore_all",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:s=>{s.success?(this.terminalLog("info",`Queued ${s.data.total} files for restore.`),this.bulkStats={completed:0,failed:0,total:s.data.total},this.currentAction="restore",this.startBulkProcessing()):(this.terminalLog("error",s.data.message),this.showToast(s.data.message,"error"),t.prop("disabled",!1).text(t.data("original-text")||"Restore All"))},error:()=>{this.terminalLog("error","Failed to queue files for restore."),this.showToast("Failed to start bulk restore","error"),t.prop("disabled",!1).text(t.data("original-text")||"Restore All")}})},handleBulkDeleteLocal(a){if(a.preventDefault(),!confirm("Delete local files for all offloaded media? Files will remain on R2. This cannot be undone."))return;const t=e(a.currentTarget);t.prop("disabled",!0).text("Queuing..."),e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_bulk_delete_local",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:s=>{s.success?(this.terminalLog("info",`Queued ${s.data.total} files for local deletion.`),this.bulkStats={completed:0,failed:0,total:s.data.total},this.currentAction="delete_local",this.startBulkProcessing()):(this.terminalLog("error",s.data.message),this.showToast(s.data.message,"error"),t.prop("disabled",!1).text(t.data("original-text")||"Free Disk Space"))},error:()=>{this.terminalLog("error","Failed to queue files for deletion."),this.showToast("Failed to start bulk delete","error"),t.prop("disabled",!1).text(t.data("original-text")||"Free Disk Space")}})},handleCancelBulk(a){a.preventDefault(),confirm("Cancel bulk operation?")&&e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_cancel_bulk",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:t=>{t.success?(this.terminalLog("warning","Bulk operation cancelled by user."),this.showToast(t.data.message,"success"),this.stopBulkProcessing()):this.showToast(t.data.message,"error")},error:()=>{this.showToast("Failed to cancel bulk operation","error")}})},startBulkProcessing(){this.isProcessing=!0,this.bulkStartTime=Date.now(),e("#cfr2-bulk-offload-all").hide(),e("#cfr2-bulk-restore-all").hide(),e("#cfr2-bulk-delete-local").hide(),e("#cfr2-retry-all-failed").hide(),e("#cfr2-cancel-bulk").show(),e("#cfr2-bulk-progress-section").show();const t={offload:"offload",restore:"restore",delete_local:"local file deletion"}[this.currentAction]||"offload";this.terminalLog("info",`Starting ${t} process...`),this.updateProgressDisplay(),this.processNextItem(),this.progressInterval=setInterval(()=>{this.updateElapsedTime()},1e3)},stopBulkProcessing(){this.isProcessing=!1,this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null),e("#cfr2-bulk-offload-all").show().prop("disabled",!1),e("#cfr2-bulk-restore-all").show().prop("disabled",!1),e("#cfr2-bulk-delete-local").show().prop("disabled",!1),e("#cfr2-retry-all-failed").show(),e("#cfr2-cancel-bulk").hide(),this.bulkStartTime=null,this.currentAction="offload",this.refreshButtonCounts()},refreshButtonCounts(){e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_get_bulk_counts",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:a=>{if(a.success){const t=a.data,s=e("#cfr2-bulk-offload-all");t.not_offloaded>0?s.show().text(`Offload All Media (${t.not_offloaded})`):s.hide();const l=e("#cfr2-bulk-restore-all");t.offloaded>0?l.show().text(`Restore All (${t.offloaded})`):l.hide();const o=e("#cfr2-bulk-delete-local");t.disk_saveable>0?o.show().text(`Free Disk Space (${t.disk_saveable})`):o.hide()}}})},processNextItem(){if(!this.isProcessing)return;const a={offload:"cfr2_process_bulk_item",restore:"cfr2_process_restore_item",delete_local:"cfr2_process_delete_local_item"},t={offload:"offload",restore:"restore",delete_local:"delete local"},s=a[this.currentAction]||"cfr2_process_bulk_item",l=t[this.currentAction]||"offload";e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:s,nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:o=>{if(o.success){const n=o.data;if(n.done){this.terminalLog("info",n.message),this.terminalLog("info",`Completed: ${this.bulkStats.completed} | Failed: ${this.bulkStats.failed}`),this.showToast(`Bulk ${l} completed`,"success"),this.stopBulkProcessing();return}const r=n.status==="success"?"success":"error";this.terminalLog(r,`${n.filename} - ${n.message}`),n.status==="success"?this.bulkStats.completed++:this.bulkStats.failed++,this.updateProgressDisplay(),this.processNextItem()}else this.terminalLog("error",o.data.message||"Unknown error"),this.stopBulkProcessing()},error:()=>{this.terminalLog("error","Network error. Retrying in 3 seconds..."),setTimeout(()=>this.processNextItem(),3e3)}})},updateProgressDisplay(){const{completed:a,failed:t,total:s}=this.bulkStats,l=a+t,o=s>0?Math.round(l/s*100):0;e(".cfr2-progress-fill").css("width",o+"%"),e(".cfr2-progress-percentage").text(o+"%"),e(".cfr2-progress-text").html(`<span style="color: #46b450;">✓ ${a}</span> | <span style="color: #dc3232;">✗ ${t}</span> | <span style="color: #646970;">○ ${s-l} remaining</span>`)},updateElapsedTime(){if(this.bulkStartTime){const a=Math.floor((Date.now()-this.bulkStartTime)/1e3),t=Math.floor(a/60),s=a%60;e("#cfr2-elapsed").text(`${t}m ${s}s`)}},terminalLog(a,t){const s=e("#cfr2-terminal-output"),l=new Date().toLocaleTimeString(),n=e(`
        <div class="cfr2-terminal-line cfr2-terminal-${a}">
          <span class="cfr2-terminal-time">[${l}]</span>
          <span class="cfr2-terminal-icon">${{info:"●",success:"✓",error:"✗",warning:"⚠"}[a]||"●"}</span>
          <span class="cfr2-terminal-message">${this.escapeHtml(t)}</span>
        </div>
      `);s.append(n),s.scrollTop(s[0].scrollHeight)},escapeHtml(a){const t=document.createElement("div");return t.textContent=a,t.innerHTML},handleCDNToggle(a){const t=e(a.currentTarget).is(":checked");e(".cdn-fields").toggle(t)},handleSmartSizesToggle(a){const t=e(a.currentTarget).is(":checked");e(".smart-sizes-options").toggle(t)},handleQualityChange(a){const t=e(a.currentTarget).val();e("#quality-value").text(t)},handleDeployWorker(a){a.preventDefault();const t=e(a.currentTarget),s=e("#worker-deploy-result");t.hasClass("is-loading")||(t.addClass("is-loading").prop("disabled",!0),s.html('<span class="spinner is-active" style="float:none;margin:0 5px;"></span>'),e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_deploy_worker",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:l=>{l.success?(s.html('<span style="color: #46b450;">✓ '+l.data.message+"</span>"),this.showToast(l.data.message,"success"),e("#remove-worker").show(),setTimeout(()=>location.reload(),1500)):(s.html('<span style="color: #dc3232;">✗ '+l.data.message+"</span>"),this.showToast(l.data.message,"error"))},error:()=>{s.html('<span style="color: #dc3232;">✗ Deployment failed</span>'),this.showToast("Worker deployment failed","error")},complete:()=>{t.removeClass("is-loading").prop("disabled",!1)}}))},handleRemoveWorker(a){if(a.preventDefault(),!confirm("Remove deployed Worker? This will disable CDN URL rewriting."))return;const t=e(a.currentTarget),s=e("#worker-deploy-result");t.hasClass("is-loading")||(t.addClass("is-loading").prop("disabled",!0),s.html('<span class="spinner is-active" style="float:none;margin:0 5px;"></span>'),e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_remove_worker",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:l=>{l.success?(s.html('<span style="color: #46b450;">✓ '+l.data.message+"</span>"),this.showToast(l.data.message,"success"),t.hide(),setTimeout(()=>location.reload(),1500)):(s.html('<span style="color: #dc3232;">✗ '+l.data.message+"</span>"),this.showToast(l.data.message,"error"))},error:()=>{s.html('<span style="color: #dc3232;">✗ Remove failed</span>'),this.showToast("Worker removal failed","error")},complete:()=>{t.removeClass("is-loading").prop("disabled",!1)}}))},loadActivityLog(){e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_get_activity_log",nonce:e("#cloudflare_r2_offload_cdn_nonce").val(),limit:50},success:a=>{if(a.success&&a.data.logs.length>0){const t=e("#cfr2-terminal-output");t.children().length<=1&&(a.data.logs.reverse().forEach(s=>{const l=s.status==="success"?"success":"error",o=new Date(s.timestamp*1e3).toLocaleTimeString(),r=e(`
                  <div class="cfr2-terminal-line cfr2-terminal-${l}">
                    <span class="cfr2-terminal-time">[${o}]</span>
                    <span class="cfr2-terminal-icon">${{success:"✓",error:"✗"}[l]}</span>
                    <span class="cfr2-terminal-message">${this.escapeHtml(s.filename)} - ${this.escapeHtml(s.message)}</span>
                  </div>
                `);t.append(r)}),t.scrollTop(t[0].scrollHeight))}}})},checkBulkProgress(){},loadFailedItems(){},handleRetryFailed(a){a.preventDefault(),confirm("Retry all failed items?")&&e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_retry_failed",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:t=>{t.success?(this.terminalLog("info",`Queued ${t.data.queued} items for retry.`),this.bulkStats={completed:0,failed:0,total:t.data.queued},this.startBulkProcessing()):this.showToast(t.data.message,"error")},error:()=>{this.showToast("Failed to retry items","error")}})},handleRetrySingle(a){a.preventDefault();const t=e(a.currentTarget).data("attachment-id");e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_retry_single",nonce:e("#cloudflare_r2_offload_cdn_nonce").val(),attachment_id:t},success:s=>{s.success?(this.showToast(s.data.message,"success"),e(a.currentTarget).closest(".cfr2-error-item").fadeOut()):this.showToast(s.data.message,"error")},error:()=>{this.showToast("Failed to retry item","error")}})},handleAttachmentOffload(a){a.preventDefault();const t=e(a.currentTarget),s=t.data("id"),l=t.data("nonce"),o=t.siblings(".cfr2-offload-status");t.prop("disabled",!0).text("Offloading..."),o.html('<span class="spinner is-active" style="float: none;"></span>'),e.ajax({url:ajaxurl,type:"POST",data:{action:"cfr2_offload_attachment",attachment_id:s,nonce:l},success:n=>{n.success?(o.html('<span style="color: #46b450;">✓ '+n.data.message+"</span>"),t.hide(),setTimeout(()=>{t.closest("td").find("span").first().html('<span style="color: #46b450; font-weight: bold;"><span class="dashicons dashicons-cloud" style="vertical-align: middle;"></span> Offloaded to R2</span>'+(n.data.url?'<br><small style="color: #666;">'+n.data.url+"</small>":"")),o.empty()},2e3)):(o.html('<span style="color: #dc3232;">✗ '+n.data.message+"</span>"),t.prop("disabled",!1).text("Offload to R2"))},error:()=>{o.html('<span style="color: #dc3232;">✗ Request failed</span>'),t.prop("disabled",!1).text("Offload to R2")}})},handleClearLog(a){a.preventDefault(),confirm("Clear process log?")&&e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_clear_log",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:t=>{t.success?(this.showToast(t.data.message,"success"),e("#cfr2-terminal-output").html(`
              <div class="cfr2-terminal-line cfr2-terminal-info">
                <span class="cfr2-terminal-prompt">$</span>
                <span>Ready. Click "Offload All Media" to start.</span>
              </div>
            `)):this.showToast(t.data.message,"error")},error:()=>{this.showToast("Failed to clear log","error")}})},handleGotoBulkActions(a){a.preventDefault(),e('.cloudflare-r2-offload-cdn-tabs li[data-tab="bulk-actions"]').trigger("click")},handleValidateCdnDns(a){a.preventDefault();const t=e(a.currentTarget),s=e("#cdn-dns-status"),l=e("#cdn_url").val();if(!l){this.showToast("Please enter a CDN URL first","error");return}t.hasClass("is-loading")||(t.addClass("is-loading").prop("disabled",!0).text("Validating..."),s.show().html('<span class="spinner is-active" style="float:none;margin:0 5px;"></span> Checking DNS...'),e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_validate_cdn_dns",nonce:e("#cloudflare_r2_offload_cdn_nonce").val(),cdn_url:l},success:o=>{if(o.success){const n=o.data;n.action==="created"?(s.html('<div class="cfr2-dns-success"><span class="dashicons dashicons-yes-alt" style="color: #46b450;"></span> '+n.message+"</div>"),this.showToast(n.message,"success")):n.action==="exists"&&(n.warnings&&n.warnings.length>0?(s.html('<div class="cfr2-dns-warning"><span class="dashicons dashicons-warning" style="color: #dba617;"></span> '+n.warnings.join("<br>")+'<br><button type="button" class="button cfr2-enable-proxy-btn" data-zone-id="'+n.zone_id+'" data-record-id="'+n.record_id+'">Enable Proxy Now</button></div>'),this.showToast("DNS record found but needs configuration","error")):(s.html('<div class="cfr2-dns-success"><span class="dashicons dashicons-yes-alt" style="color: #46b450;"></span> DNS record found with proxy enabled. Ready to deploy!</div>'),this.showToast("DNS validation passed!","success")))}else s.html('<div class="cfr2-dns-error"><span class="dashicons dashicons-dismiss" style="color: #dc3232;"></span> '+o.data.message+"</div>"),this.showToast(o.data.message,"error")},error:()=>{s.html('<div class="cfr2-dns-error"><span class="dashicons dashicons-dismiss" style="color: #dc3232;"></span> Validation request failed</div>'),this.showToast("DNS validation failed","error")},complete:()=>{t.removeClass("is-loading").prop("disabled",!1).text("Validate DNS")}}))},handleEnableDnsProxy(a){a.preventDefault();const t=e(a.currentTarget),s=t.data("zone-id"),l=t.data("record-id"),o=e("#cdn-dns-status");t.hasClass("is-loading")||(t.addClass("is-loading").prop("disabled",!0).text("Enabling..."),e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_enable_dns_proxy",nonce:e("#cloudflare_r2_offload_cdn_nonce").val(),zone_id:s,record_id:l},success:n=>{n.success?(o.html('<div class="cfr2-dns-success"><span class="dashicons dashicons-yes-alt" style="color: #46b450;"></span> '+n.data.message+" Ready to deploy!</div>"),this.showToast(n.data.message,"success")):(this.showToast(n.data.message,"error"),t.removeClass("is-loading").prop("disabled",!1).text("Enable Proxy Now"))},error:()=>{this.showToast("Failed to enable proxy","error"),t.removeClass("is-loading").prop("disabled",!1).text("Enable Proxy Now")}}))},handleShowPending(a){a.preventDefault(),e("#cfr2-pending-section").show(),this.loadPendingItems()},handleClosePending(a){a.preventDefault(),e("#cfr2-pending-section").hide()},loadPendingItems(){const a=e("#cfr2-pending-list");a.html('<p class="cfr2-loading">Loading...</p>'),e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_get_pending_items",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:t=>{if(t.success){const s=t.data.items;if(s.length===0){a.html('<p class="cfr2-empty">No pending items in queue.</p>');return}let l='<table class="cfr2-pending-table"><thead><tr><th>File</th><th>Action</th><th>Status</th><th></th></tr></thead><tbody>';s.forEach(o=>{const n=o.status==="processing"?"cfr2-status-processing":"cfr2-status-pending",r=o.status==="pending",i=parseInt(o.id,10)||0;l+=`<tr data-id="${i}">
                <td class="cfr2-pending-filename">${this.escapeHtml(o.filename)}</td>
                <td><span class="cfr2-action-badge">${this.escapeHtml(o.action)}</span></td>
                <td><span class="${n}">${this.escapeHtml(o.status)}</span></td>
                <td>${r?`<button type="button" class="button button-small cfr2-cancel-pending-item" data-id="${i}">Cancel</button>`:'<span class="cfr2-processing-indicator">●</span>'}</td>
              </tr>`}),l+="</tbody></table>",a.html(l)}else a.html('<p class="cfr2-error">Failed to load pending items.</p>')},error:()=>{a.html('<p class="cfr2-error">Failed to load pending items.</p>')}})},handleCancelPendingItem(a){a.preventDefault();const t=e(a.currentTarget),s=t.data("id"),l=t.closest("tr");t.prop("disabled",!0).text("Cancelling..."),e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_cancel_pending_item",nonce:e("#cloudflare_r2_offload_cdn_nonce").val(),item_id:s},success:o=>{o.success?(l.fadeOut(300,()=>{l.remove(),e("#cfr2-pending-list tbody tr").length===0&&e("#cfr2-pending-list").html('<p class="cfr2-empty">No pending items in queue.</p>')}),this.showToast(o.data.message,"success"),this.updatePendingStat()):(this.showToast(o.data.message,"error"),t.prop("disabled",!1).text("Cancel"))},error:()=>{this.showToast("Failed to cancel item","error"),t.prop("disabled",!1).text("Cancel")}})},handleClearPending(a){if(a.preventDefault(),!confirm("Cancel all pending items? This will not affect items currently being processed."))return;const t=e(a.currentTarget);t.prop("disabled",!0).text("Clearing..."),e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_clear_pending",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:s=>{s.success?(this.showToast(s.data.message,"success"),this.loadPendingItems(),this.updatePendingStat()):this.showToast(s.data.message,"error")},error:()=>{this.showToast("Failed to clear pending items","error")},complete:()=>{t.prop("disabled",!1).text("Clear All")}})},updatePendingStat(){e.ajax({url:myPluginAdmin.ajaxUrl,type:"POST",data:{action:"cfr2_get_bulk_counts",nonce:e("#cloudflare_r2_offload_cdn_nonce").val()},success:a=>{if(a.success&&typeof a.data.pending<"u"){const t=a.data.pending,s=e("#cfr2-pending-stat");s.find(".cfr2-stat-value").text(t.toLocaleString()),t>0?(s.addClass("cfr2-stat-clickable"),s.find(".dashicons").show()):(s.removeClass("cfr2-stat-clickable"),s.find(".dashicons").hide())}}})}};e(document).ready(()=>{c.init()})})(jQuery);
//# sourceMappingURL=admin.js.map
